- Inside the project directory, create a new folder named **`e2e-tests`**.
- Install the Playwright framework in the `e2e-tests` folder using: `npm init playwright@latest`
-  This will install the Playwright package along with the required configuration and example tests. ✅

``` bash
cd e2e-tests
npm init playwright@latest
```
# 10.1 Setting Up and Writing Playwright Tests
- Install the **Playwright Test for VS Code** extension.
- Go to the `e2e-tests` folder and open `example.spec.ts`.
- Rename the file from `example.spec.ts` to `auth.spec.ts`.
- The way Playwright tests work is:
	1. Navigate to a page.
	2. Perform actions (e.g., click a button, fill a form, or follow a link).
	3. Use **assertions** to check whether the expected result is valid or not.
- **auth.spec.ts**
```ts
import { test, expect } from '@playwright/test';
test('has title', async ({ page }) => {
  await page.goto('https://playwright.dev/');
  
  // Expect a title "to contain" a substring.
  await expect(page).toHaveTitle(/Playwright/);
});

test('get started link', async ({ page }) => {
  await page.goto('https://playwright.dev/');

  // Click the get started link.
  await page.getByRole('link', { name: 'Get started' }).click();

  // Expects page to have a heading with the name of Installation.
  await expect(page.getByRole('heading', { name: 'Installation' })).toBeVisible();
});
```
## **Writing and Running Playwright Tests**
 - Start test descriptions with **“should”** or **“should not”**.
	 - Example: `should allow the user to sign in.`
	 - Example: `should not allow the user to sign in with invalid credentials.`
- Use the **Debug** option in VS Code to run tests.
- If tests pass, a **green check mark (✔)** will be visible.
### 1. Writing a Test for User Sign-In
- `page` represents the browser window and is used to perform actions and assertions.
- Navigate to the page and click the **Sign In** link using `getByRole()`.
- Run the backend in E2E mode: `npm run e2e`.
- run the backend app in e2e environment `npm run e2e`.
- manually add the user details to the test database.

```ts
import { test, expect } from "@playwright/test";
const UI_URL = "http://localhost:5173/";

test('should navigate to homepage', async ({ page }) => {

    await page.goto(UI_URL);
    
    // get the Sign In button
    await page.getByRole("link", { name: "Sign In" }).click();

    // Assertion: expect Sign In page heading to be visible
    await expect(page.getByRole("heading", { name: "Sign In Page"
    })).toBeVisible();

    // find the element on the page with name email
    // add this user manually to test database
    await page.locator([name=email]").fill("codevwithpaul@gmail.com");
    await page.locator("[name=password]").fill("ashish");

    // click on login button
    await page.getByRole("button", { name: "Sign In" }).click();
    await expect(page.getByText("Registration
    Successful!")).toBeVisible();

	await expect(page.getByRole("link", { name: "My Booking"
	})).toBeVisible();
    await expect(page.getByRole("link", { name: "My Hotels"
    })).toBeVisible();
    await expect(page.getByRole("button", { name: "Sign Out"
    })).toBeVisible();

});
```
#### Error Case: Login Without Registered User
- Manually add the user to the test database to test login without registration.
- If the user is not added, filling the form and clicking Sign In will give an error.
![](Images/Pasted%20image%2020251002224957.png)

### Success Case: Login Without Registered User
- Go to e2e-test-db/users database in mongodb.
- Click on insert document and insert user info from development database.
```json
{
  "_id": { "$oid": "68dae43575d56ac5ff67b0a4" },
  "email": "ashishpaul1199@gmail.com",
  "password": "$2b$08$e5frWIr/QCONtXQdGXQrauw5dVP8YhmEC6xzAA0R7E9oOQvj91wI2",
  "firstName": "GADDALA",
  "lastName": "ASHISH",
  "__v": { "$numberInt": "0" }
}
```

- `.env.e2e`
```env
MONGODB_CONNECTION_STRING=mongodb+srv://ashishpaul99:password@cluster0.exm5h3r.mongodb.net/e2e-test-db?retryWrites=true&w=majority&appName=Cluster0
JWT_SECRET_KEY=6b028aedd15181d89aeffdb9d4bcb95a877b3f415662c6646749715ccfdcd1dcc3de6fdcc4612b50a1d95d90a81e11e4ccc773d940fdfdaba5af7d3b57f2a955
FRONTEND_URL=http://localhost:5173
```

- run the test again
![](Images/Pasted%20image%2020251002232421.png)
### 2. Writing a Test for User Registration

```ts
import { test, expect } from "@playwright/test";
const UI_URL = "http://localhost:5173/";

// Test: User should be able to successfully sign in (actually sign up + auto login)
test("should allow user to sign in", async ({ page }) => {

  //generating a unique random email address each time the test runs
  const testEmail = `test_register_${Math.floor(Math.random() * 90000) +
  1000}@test.com`;
  // Navigate to the app's homepage
  await page.goto(UI_URL);

  // Click on "Sign Up" link
  await page.getByRole("link", { name: "Sign Up" }).click();

  // Verify "Create an Account" heading is visible
  await expect(page.getByRole("heading", { name: "Create an Account" })).toBeVisible();

  // Fill registration form fields
  await page.locator("[name=firstName]").fill("Ashish");
  await page.locator("[name=lastName]").fill("G");
  await page.locator("[name=email]").fill("paul444@gmail.com");
  await page.locator("[name=password]").fill("ashish");
  await page.locator("[name=confirmPassword]").fill("ashish");

  // Click on "Create Account" button
  await page.getByRole("button", { name: "Create Account" }).click();

  // ✅ Assert success message appears
  await expect(page.getByText("Registration Successful!")).toBeVisible();

  // ✅ Assert user is redirected to logged-in state with nav links/buttons visible
  await expect(page.getByRole("link", { name: "My Booking" })).toBeVisible();
  await expect(page.getByRole("link", { name: "My Hotels" })).toBeVisible();
  await expect(page.getByRole("button", { name: "Sign Out" })).toBeVisible();
});
```

#### Generating a **unique random email address** each time the test runs
-  Running this test more than once with a **hardcoded email** will cause an error (`User already exists`).
- - The best fix is to **generate a random email** each time the test runs.
```ts
const testEmail = `test_register_${Math.floor(Math.random() * 90000) + 1000}@test.com`;

```
- **`Math.random()`** → generates a random number between `0` and `1`.
- **`Math.random() * 90000`** → scales it up to a number between `0` and `89999`.
- **`Math.floor(...)`** → removes the decimal part (integer only).
- **`+ 1000`** → ensures the number is at least 1000 (so it’s never too short).
    - Final number range: `1000 – 90999`.